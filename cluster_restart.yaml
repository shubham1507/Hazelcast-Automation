---
- hosts: "{{ hostname }}"
  remote_user: hzadm
  gather_facts: no

  tasks:
    - name: Fail if no hosts matched
      fail:
        msg: "No host matched for {{ hostname }}"
      when: ansible_play_hosts_all | length == 0

    - name: Copying ManCenter.sh script to remote server
      copy:
        src: ManCenter.sh
        dest: /home/hzadm
        mode: '0755'
      when: mancenter == "true"

    - name: Run mancenter stop
      shell: "source /home/hzadm/.bash_profile && nohup /opt/HZ/hazelcast/bin/stopManCenter.sh mancenter"
      when: (action == "restart" or action == "stop") and mancenter == "true"
      register: command_output

    - name: Debug command output (stop)
      debug:
        var: command_output

    - name: Run mancenter start
      shell: "source /home/hzadm/.bash_profile && nohup /opt/HZ/hazelcast/bin/startManCenter.sh mancenter"
      when: (action == "restart" or action == "start") and mancenter == "true"
      register: command_output

    - name: Debug command output (start)
      debug:
        var: command_output

  roles:
    - { role: cluster-restart, when: mancenter == "false" }
